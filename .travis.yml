dist: bionic

language: python

cache: pip

# Only run on main (still tests PRs)
branches:
  only:
  - main
  - /v\d+.\d+.\d+/

notifications:
  email: true

matrix:
  include:
    - python: '3.7'
    - python: '3.8'
    - python: '3.9'
    - python: '3.10'

install:
- sudo apt-get update
- sudo apt-get install pandoc
- pip install pypandoc
- echo -e "machine github.ibm.com\n  login $GITHUB_OAUTH_TOKEN" > ~/.netrc
- pip install setuptools=="60.8.2"

script:
- make ci

deploy:
- provider: pypi
  user: __token__
  password:
    secure: H6pxBCHf26B/9qi/3I6W7NkXnSwbPq04GiD06/z6MfZZkM2QQhbwFvDE55BrLhDskbpSEDNH18JuHMlDKu/ihNjDGw7dVnMTjs1/Uf1QlbrZRRtMhQBp3OuVRmE1mPc1PfYyYZlfqDQZkV6oz7NHI69x6Nz68Ltq6S+FaTT/8C72MoF3E4+ea6i/m8FRrxL6XS4ak7eXP1sKWPg3Sf7uEFwYsAWI/gcpjw2mnrqNCJWXkQmbVwWawo1GbfvIAs7ykhWkyZL+heuagdTmE9XEnnXrInp+U9ean5TcS1RMtDHzfB1TndVDxzZQBPwpXR7CdJcBft/NI2h/qA9xQr2DeC5BVLe5UvlPjIQ8KPK6wy2HOi2XwvXJZ3AVRyXPhujr3eLe8wFW/g9k/RPqs1ptwMYSav62gaPzZQzt3fj4dqLblj+nlZE+pAPS1K4Yr+vDQ6JqPhvK4e3f/kg64BjgDdM5aHPWsAvRaMZ6elS3N1v3I5bDxcS0YkdHtbESJUyI/72BZL8svYFOiUi5kmYGM+/VizBE1Ld2nRFH4MpGAQn0AmoR/Wr0WViEQCNoSRHswZxqidudi/tNuMx/w/P/tx8b34s0A1YG/638jaNnIYyWseBSyY465GzgzLbKe4//qO4G38PCieWqP55aULPNDdddFrW02hzwQ/U/PznI8hg=
  repository: https://upload.pypi.org/legacy
  skip_cleanup: true
  on:
    python: '3.10'
    tags: true